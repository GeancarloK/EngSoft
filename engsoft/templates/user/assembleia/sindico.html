{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Assembleias</title>
    <link rel="stylesheet" href="{% static 'stylesheets/user.css' %}">
    <style>
        .assembleia-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .assembleia-item h3 {
            margin-bottom: 10px;
        }
        .assembleia-item p {
            margin-bottom: 15px;
        }
        .assembleia-item ul {
            padding-left: 20px;
        }
        .assembleia-item form {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    {% include "header.html" %}
    <div class="container">
        <h1 class="my-4">Assembleias</h1>

        {% if assembleias %}
            <ul class="list-unstyled">
            {% for assembleia in assembleias %}
                <li class="assembleia-item">
                    <h3>{{ assembleia.titulo }} - Status: {{ assembleia.get_status_display }}</h3>
                    <p>{{ assembleia.descricao }}</p>

                    {% if assembleia.status == 'criada' %}
                        <form method="post" action="{% url 'iniciar_assembleia' assembleia.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">Iniciar</button>
                        </form>
                    {% elif assembleia.status == 'iniciada' %}
                        <h4>Requisições:</h4>
                        <ul>
                        {% for requisicao in assembleia.requisicoes.all %}
                            <li><strong>{{ requisicao.titulo }}</strong> - {{ requisicao.descricao }}</li>
                        {% endfor %}
                        </ul>

                        <h4>Resultados Parciais:</h4>
                        <ul>
                        {% for votacao in assembleia.votos.all %}
                            <li><strong>{{ votacao.titulo }}</strong></li>
                            <ul>
                            {% for opcao in votacao.opcoes_votacao.all %}
                                <li>{{ opcao.titulo }}: {{ opcao.votos }} votos</li>
                            {% endfor %}
                            </ul>
                        {% endfor %}
                        </ul>

                        <form method="get" action="{% url 'criar_votacao' assembleia.id %}">
                            <button type="submit" class="btn btn-primary">Criar Nova Votação</button>
                        </form>
                    {% elif assembleia.status == 'finalizada' %}
                        <form method="post" action="{% url 'entregar_assembleia' assembleia.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success">Entregar</button>
                        </form>
                    {% endif %}
                    <form method="post" action="{% url 'finalizar_assembleia' assembleia.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Finalizar</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>Não há assembleias acontecendo no momento.</p>
        {% endif %}

        <!-- Botão para voltar para a home -->
        <div class="mt-4">
            <a href="{% url 'user_home' %}" class="btn btn-secondary">Voltar</a>
        </div>
    </div>
    {% include "footer.html" %}
</body>
</html>
